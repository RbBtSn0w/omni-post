[pytest]
# 添加测试搜索路径
testpaths = tests

# 测试文件匹配模式
python_files = test_*.py

# 测试类匹配模式
python_classes = Test*

# 测试函数匹配模式
python_functions = test_*

# 启用异步测试支持
asyncio_mode = auto

# 启用代码覆盖率
addopts = --cov=src --cov-config=.coveragerc --cov-fail-under=20 --cov-report=term-missing --cov-report=html:./test-results/coverage/html --cov-report=json:./test-results/coverage/coverage.json --cov-report=xml:./test-results/coverage/coverage.xml -W ignore::DeprecationWarning --junit-xml=./test-results/reports/test_results.xml --junit-prefix=backend

# 测试超时配置
timeout = 30

# 日志级别
log_cli = true
log_level = INFO
log_file = ./test-results/logs/pytest.log
log_file_level = INFO
log_file_format = %(asctime)s - %(name)s - %(levelname)s - %(message)s

# 忽略的目录
norecursedirs = .git __pycache__ *.pyc venv .venv

# 测试环境变量
env =
    TEST_MODE=True
    DEBUG_MODE=False

# 测试分组标记
markers =
    unit: 单元测试，Mock所有外部依赖
    integration: 集成测试，模拟关键业务行为
    e2e: 端到端测试，验证完整用户交互流程
    slow: 慢测试，需要较长时间执行
    fast: 快测试，秒级完成
    login: 登录相关测试
    auth: 认证相关测试
    timeout: 登录/轮询超时相关测试
